<& /Admin/Elements/Header, Title => loc("Rights Debugger") &>
<& /Elements/Tabs &>

<form action="<%RT->Config->Get('WebPath')%>/Helpers/RightsDebugger/Search" id="rights-debugger">
  <div class="search">
    <input type="text" name="principal" placeholder="Principal">
    <input type="text" name="object" placeholder="Object">
    <input type="text" name="right" placeholder="Right">
    <span class="loading"><img src="<%RT->Config->Get('WebPath')%>/static/images/loading.gif" alt="<%loc('Loading')%>" title="<%loc('Loading')%>" /></span>
  </div>
  <div class="results">
  </div>
</form>

<script type="text/x-template" id="debugger-record-template">
  {{#if url}}
      <a target="_blank" href="{{url}}">{{label}}</a>
  {{else}}
      {{label}}
  {{/if}}

  <span class="detail">{{detail}}</span>
</script>

<script type="text/x-template" id="debugger-result-template">
  <div class="result">
    <div class="principal cell">{{> render_record item.principal}}</div>
    <div class="object cell">{{> render_record item.object}}</div>
    <div class="right cell">{{search_highlight item.right search.right}}</div>
    <div class="revoke cell">
        <button {{#if item.disable_revoke}}class="ui-state-disabled" disabled="disabled"{{/if}}>Revoke</button>
    </div>
  </div>
</script>

<%INIT>
unless ($session{'CurrentUser'}->HasRight( Object=> RT->System, Right => 'SuperUser')) {
    Abort(loc('This feature is only available to system administrators.'));
}
</%INIT>
